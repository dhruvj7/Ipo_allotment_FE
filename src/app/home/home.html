<div class="parent-container">
  <div class="form-container" *ngIf="!resultDisplay()">
    <form [formGroup]="ipoForm" id="input-form" class="card">
      <h2 class="title">Check IPO Allotment Status</h2>

      <div class="form-group">
        <label for="ipoName">Select IPO</label>
        <select id="ipoName" formControlName="ipoName" class="dropdown">
          <option value="" selected>Select IPO</option>
          <option *ngFor="let ipo of ipoList()" [value]="ipo.companyId">
            {{ ipo.companyName }}
          </option>
        </select>
      </div>

      <div class="form-group">
        <label for="panNumber">PAN Number</label>
        <input
          id="panNumber"
          type="text"
          class="input-box"
          formControlName="panNumber"
          placeholder="Enter PAN number"
        />
        <div *ngIf="errorMessage()" class="error-message">Invalid PAN number</div>
      </div>

      <div class="button">
        <button
          type="button"
          (click)="getAllotmentDetails()"
          class="submit-button"
          [disabled]="ipoForm.invalid"
        >
          Check Allotment
        </button>
      </div>
      <div class="registrar-list">
        <h4>Registrars covered :</h4>
        <ul>
          <li>Bigshare Services Pvt. Ltd.</li>
          <li>KFin Technologies</li>
          <li>MUFG Intime India Private Limited (Link Intime India Pvt Ltd)</li>
        </ul>
      </div>
    </form>
  </div>

  <div *ngIf="resultDisplay()" class="result-container card">
    <h2 class="title">IPO Allotment Results</h2>

    <table class="table">
      <tr>
        <td class="heading">Company Name</td>
        <td>{{ selectedIpo().companyName ?? '' }}</td>
      </tr>
      <tr>
        <td class="heading">Applicant Name</td>
        <td>{{ allotmentResult().applicantName }}</td>
      </tr>
      <tr>
        <td class="heading">Allotment Status</td>
        <td
          [class.allotted]="allotmentResult().allotted"
          [class.not-allotted]="!allotmentResult().allotted"
        >
          {{ allotmentResult().allotted ? 'Allotted üéâ' : 'Not Allotted ‚ùå' }}
        </td>
      </tr>
      <tr>
        <td class="heading">Shares Applied</td>
        <td>{{ allotmentResult().numberOfSharesApplied }}</td>
      </tr>
      <tr>
        <td class="heading">Shares Allotted</td>
        <td>{{ allotmentResult().numberOfSharesAlloted }}</td>
      </tr>
      <tr>
        <td class="heading">PAN Number</td>
        <td>{{ ipoForm.value.panNumber }}</td>
      </tr>
    </table>

    <div class="registrar-details">
      <div>
        <strong>Registrar Name: </strong>
        <span>{{ selectedIpo().registrarName }}</span>
      </div>
      <div>
        <strong>Registrar Website: </strong>
        <a href="{{ selectedIpo().registrarWebsite }}" target="_blank">
          {{ selectedIpo().registrarWebsite }}
        </a>
      </div>
    </div>

    <div class="button">
      <button (click)="back()" class="submit-button secondary">Check Another IPO</button>
    </div>
  </div>
</div>

<!-- Error Popup -->
<div class="error-popup-overlay" *ngIf="showErrorPopup()">
  <div class="error-popup">
    <h3>‚ö†Ô∏è Something went wrong</h3>
    <p>{{ errorMessageText() }}</p>
    <button class="close-btn" (click)="closeErrorPopup()">Close</button>
  </div>
</div>

<!-- loader -->
<div
  class="spinner-overlay"
  role="status"
  aria-live="polite"
  aria-busy="true"
  id="loader"
  *ngIf="isLoading()"
>
  <div class="spinner"></div>
  <span class="visually-hidden">Loading‚Ä¶</span>
</div>

<!-- Privacy Banner -->
<div class="privacy-banner">
  <p>Your PAN stays safe ‚Äî we don't save or share it. Ever :)</p>
</div>